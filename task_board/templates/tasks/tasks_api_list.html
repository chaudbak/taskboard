{% extends "base.html" %}

{% load staticfiles %}
{% load bootstrap_pagination %}

{% block css %}
{{ block.super }}
<link href="{% static 'css/task-list.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="row task-list-page-header">
  <div class="col-md-8">
    {% if paginator %}
    {% bootstrap_paginate paginator.page range=10 %}
    {% endif %}
  </div>
  <div class="col-md-3">
  </div>
  <div class="col-md-1">
    {% if filter_form %}
    <button style="float: right; " data-toggle="modal" data-target="#filtersModal"
            class="btn btn-default">
      <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
      Search
    </button>
  </div>
  {% endif %}
</div>

<div class="row">
  <div class="col-md-12 task-list">
    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
      <table class="table table-bordered">

        <tbody>
        <tr class="active">
          <th class="text-center">Name</th>
          <th class="text-center">Owner</th>
          <th class="text-center">Status</th>
          <th class="text-center">Actions</th>
        </tr>
        {% for task in results %}
        <tr class="clickable">
          <td class="col-md-7">
            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#task-data-{{ forloop.counter }}"
               aria-expanded="false" aria-controls="task-data-{{ forloop.counter }}">
              {{ task.name }}
            </a>
          </td>
          <td class="col-md-1 text-center">
            {{ task.created_by_username }}
          </td>
          <td class="col-md-1 text-center">
            <span class="status-label label label-primary">{{ task.status }}</span>
            {{ task.accomplished_by }}
          </td>
          <td class="col-md-3 text-center">
            <div class="control-buttons">
              {% if user.pk == task.created_by %}
              <button id="edit-button" class="submit btn btn-default">Edit</button>
              <button id="delete-button" class="submit btn btn-default">Delete</button>
              {% endif %}
              <button id="markdone-button" class="submit btn btn-default">Mark as Done</button>
            </div>
          </td>
        </tr>
        <tr id="task-data-{{ forloop.counter }}" class="panel-collapse collapse in" role="tabpanel"
            aria-labelledby="task-heading-{{ forloop.counter }}">
          <td>
            {{ task.description }}
          </td>
        </tr>

        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% if filter_form %}
{{ filter_form }}
{% endif %}

{% endblock content %}

{% block javascript %}
{{ block.super }}
<script>$('#accordion .collapse').collapse('hide');</script>
{% endblock %}
